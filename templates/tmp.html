<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ECharts</title>
    <!-- Include the ECharts file you just downloaded -->
    <script src="/static/echarts.js"></script>
  </head>
  <body>

    <!-- Prepare a DOM with a defined width and height for ECharts -->
<div id="main" style="width: 900px; height:800px;"></div>

<script type="text/javascript">
var chartDom = document.getElementById('main');
var myChart = echarts.init(document.querySelector('#main'), null,
  );

function autoFontSize() {
  let width = document.getElementById('main').offsetWidth;
  let newFontSize = Math.round(width /40);
  return newFontSize;
};


var option;

// There should not be negative values in rawData
const rawData = [
  [100, 302, 301, 334, 390],
  [320, 132, 101, 134, 90],
  [220, 182, 191, 234, 290],
  [150, 212, 201, 154, 190],
  [820, 832, 901, 934, 1290]
];
const totalData = [];
for (let i = 0; i < rawData[0].length; ++i) {
  let sum = 0;
  for (let j = 0; j < rawData.length; ++j) {
    sum += rawData[j][i];
  }
  totalData.push(sum);
}
const grid = {
  left: 100,
  right: 100,
  top: 50,
  bottom: 50
};
const series = [
  'Direct',
  'Mail Ad',
  'Affiliate Ad',
  'Video Ad',
  'Search Engine'
].map((name, sid) => {
  return {
    name,
    type: 'bar',
    stack: 'total',
    barWidth: '60%',
    label: {
      show: true,
      textStyle: {
        fontSize: autoFontSize(),
        fontStyle: 'bold',
      },
      formatter: (params) => Math.round(params.value * 1000) / 10 + '%'
    },
    data: rawData[sid].map((d, did) =>
      totalData[did] <= 0 ? 0 : d / totalData[did]
    )
  };
});
option = {
  textStyle: {fontSize: 11},
  legend: {
    selectedMode: false,
    textStyle: {fontSize: autoFontSize()}
  },
  grid,
  yAxis: {
    type: 'value'
  },
  xAxis: {
    type: 'category',
<!--    nameTextStyle: {fontSize: autoFontSize()},-->
    data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri']
  },
  series
};

myChart.setOption(option);

window.addEventListener('resize', function() {
 if (myChart != null && myChart != undefined) {
     myChart.resize(
     {width: 'auto',
      height: 'auto'}
    );
    myChart.setOption({
      series: {
        label: {
          textStyle: {
            fontSize: autoFontSize()
          }
        }
      }
    })
}
     });

    </script>
  </body>
</html>